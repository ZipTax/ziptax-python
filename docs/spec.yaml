# =============================================================================
# SDK Generation Template for Ziptax API
# =============================================================================
# This template provides a comprehensive spec for codegen agents

# -----------------------------------------------------------------------------
# Project Metadata
# -----------------------------------------------------------------------------
project:
  name: "ziptax-sdk"
  language: "python"
  version: "0.2.3-beta"
  description: "Official Python SDK for the ZipTax API with optional TaxCloud order management support"

  # Repository information
  repository:
    url: "https://github.com/ziptax/ziptax-python"
    type: "git"

  # License
  license: "MIT"

  # Maintainer information
  maintainers:
    - name: "Ziptax Team"
      email: "support@zip.tax"

# -----------------------------------------------------------------------------
# API Configuration
# -----------------------------------------------------------------------------
# The SDK now supports TWO APIs:
# 1. ZipTax API - For tax rate lookups and account metrics (REQUIRED)
# 2. TaxCloud API - For order management operations (OPTIONAL)

api:
  # Primary API (ZipTax) - REQUIRED for all SDK functionality
  ziptax:
    name: "ZipTax API"
    version: "v60"
    base_url: "https://api.zip-tax.com/"

    # API specification source
    spec:
      type: "openapi"
      version: "3.0.0"
      source: "https://api.zip-tax.com/openapi.json"

    # Authentication methods
    authentication:
      type: "api_key"
      location: "header"
      parameter_name: "X-API-Key"
      required: true

  # Secondary API (TaxCloud) - OPTIONAL for order management
  taxcloud:
    name: "TaxCloud API"
    version: "v3"
    base_url: "https://api.v3.taxcloud.com/"
    documentation: "https://docs.taxcloud.com/api-reference/api-reference/sales-tax-api/orders/create-order"

    # Authentication methods
    authentication:
      type: "api_key"
      location: "header"
      parameter_name: "X-API-Key"
      required: false  # Only required if using TaxCloud features

    # Additional authentication requirements
    required_parameters:
      - name: "connectionId"
        description: "TaxCloud Connection ID (UUID format) - used in API paths"
        format: "uuid"
        example: "25eb9b97-5acb-492d-b720-c03e79cf715a"

    # Feature availability notes
    notes:
      - "TaxCloud features are OPTIONAL and only available when both Connection ID and API Key are provided during client initialization"
      - "Order management functions will return error if TaxCloud credentials not configured"
      - "Uses Header authentication with the X-API-KEY header for both APIs, but TaxCloud also requires the connectionId in the path for order endpoints"

# -----------------------------------------------------------------------------
# SDK Configuration
# -----------------------------------------------------------------------------
sdk:
  # Package/module naming
  package_name: "ziptax"
  namespace: "Ziptax"

  # SDK structure approach
  structure:
    type: "client-based"
    client_class: "ZiptaxClient"

  # Features to include
  features:
    async_support: true       # Include async/await methods
    retry_logic: true         # Automatic retry on failures
    request_logging: true     # Built-in request/response logging
    response_caching: false   # Cache responses
    pagination_helpers: true  # Helper methods for paginated endpoints
    batch_operations: false   # Batch request support
    webhooks: false           # Webhook handling utilities

  # Error handling
  error_handling:
    use_custom_exceptions: true
    exception_hierarchy: true  # Create exception hierarchy
    include_retry_exceptions: true

  # Type safety
  type_safety:
    use_type_hints: true      # Language-specific
    validate_inputs: true     # Runtime input validation
    strict_mode: false        # Strict type checking

# -----------------------------------------------------------------------------
# API Endpoints & Resources
# -----------------------------------------------------------------------------
# Define the API structure and endpoints to implement
resources:
      - name: "GetSalesTaxByAddress"
        http_method: "GET"
        path: "/request/v60/"
        description: "Returns sales and use tax rate details from an address input."
        operation_id: "getTaxRatesV60"
        parameters:
          - name: "address"
            type: "string"
            required: true
            location: "query"
            description: "Full or partial street address for geocoding"
            validation:
              max_length: 100
          - name: "taxabilityCode"
            type: "string"
            format: "number"
            required: false
            location: "query"
            description: "Taxability Code (product or service code)"
            validation:
              pattern: "^[0-9]+$"
          - name: "countryCode"
            type: "string"
            required: false
            location: "query"
            description: "Country code"
            default: "USA"
            enum: ["USA", "CAN"]
          - name: "historical"
            type: "string"
            format: "date"
            required: false
            location: "query"
            description: "Historical date for rates (YYYYMM format, e.g. 202401)"
            validation:
              pattern: "^[0-9]{6}$"
          - name: "format"
            type: "string"
            required: false
            location: "query"
            description: "Response format"
            default: "json"
            enum: ["json"]
        returns:
          type: "V60Response"
          is_array: false
      - name: "GetSalesTaxByGeoLocation"
        http_method: "GET"
        path: "/request/v60/"
        description: "Returns sales and use tax rate details from a geolocation input."
        operation_id: "getTaxRatesV60"
        parameters:
          - name: "lat"
            type: "string"
            required: true
            location: "query"
            description: "Latitude for geolocation"
            validation:
              max_length: 100
          - name: "lng"
            type: "string"
            required: true
            location: "query"
            description: "Longitude for geolocation"
            validation:
              max_length: 100
          - name: "countryCode"
            type: "string"
            required: false
            location: "query"
            description: "Country code"
            default: "USA"
            enum: ["USA", "CAN"]
          - name: "historical"
            type: "string"
            format: "date"
            required: false
            location: "query"
            description: "Historical date for rates (YYYYMM format, e.g. 202401)"
            validation:
              pattern: "^[0-9]{6}$"
          - name: "format"
            type: "string"
            required: false
            location: "query"
            description: "Response format"
            default: "json"
            enum: ["json"]
        returns:
          type: "V60Response"
          is_array: false
      - name: "GetRatesByPostalCode"
        http_method: "GET"
        path: "/request/v60/"
        description: "Returns sales and use tax rate details from a US postal code input."
        operation_id: "getTaxRatesV60ByPostalCode"
        parameters:
          - name: "postalcode"
            type: "string"
            required: true
            location: "query"
            description: "US postal code (5-digit or 9-digit format)"
            validation:
              pattern: "^[0-9]{5}(-[0-9]{4})?$"
          - name: "format"
            type: "string"
            required: false
            location: "query"
            description: "Response format"
            default: "json"
            enum: ["json", "xml"]
        returns:
          type: "V60PostalCodeResponse"
          is_array: false
      - name: "GetAccountMetrics"
        http_method: "GET"
        path: "/account/v60/metrics"
        description: "Returns account metrics related to sales and use tax."
        operation_id: "getAccountMetricsV60"
        parameters:
          - name: "key"
            type: "string"
            required: false
            location: "query"
            description: "Response format"
            default: "json"
            enum: ["json", "xml"]
        returns:
          type: "V60AccountMetrics"
          is_array: false

      # -----------------------------------------------------------------------
      # Cart Tax Calculation - Dual API Routing
      # -----------------------------------------------------------------------
      # The CalculateCart function supports TWO backends:
      #   1. ZipTax API (default) - POST /calculate/cart
      #   2. TaxCloud API (when configured) - POST /tax/connections/{connectionId}/carts
      #
      # Routing logic in Functions.CalculateCart:
      #   - If TaxCloud credentials ARE configured (has_taxcloud_config == True),
      #     route to TaxCloud API and return TaxCloudCalculateCartResponse
      #   - If TaxCloud credentials are NOT configured, route to ZipTax API
      #     and return CalculateCartResponse (existing behavior)
      #
      # The INPUT contract (CalculateCartRequest) is IDENTICAL for both backends.
      # The SDK handles request transformation internally when routing to TaxCloud.
      # The OUTPUT contract differs: CalculateCartResponse vs TaxCloudCalculateCartResponse.
      # The return type is Union[CalculateCartResponse, TaxCloudCalculateCartResponse].
      # -----------------------------------------------------------------------

      # ZipTax Cart Tax Calculation Endpoint (default when TaxCloud not configured)
      - name: "CalculateCart"
        api: "ziptax"
        http_method: "POST"
        path: "/calculate/cart"
        description: |
          Calculate sales tax for a single cart with multiple line items.
          Accepts a cart with destination and origin addresses, calculates
          per-item tax, and returns tax rate and amount for each line item.

          ROUTING BEHAVIOR: When the SDK client is initialized with TaxCloud
          credentials (taxcloud_connection_id and taxcloud_api_key), this
          function automatically routes the request to the TaxCloud API
          instead of the ZipTax API. The input contract (CalculateCartRequest)
          remains the same regardless of which backend is used. The SDK
          transforms the request internally. The response type changes based
          on the backend used.

          IMPLEMENTATION NOTES for routing in Functions.CalculateCart:
            1. Check self.config.has_taxcloud_config at the START of the method
            2. If True: transform request and POST to TaxCloud, return TaxCloudCalculateCartResponse
            3. If False: POST to ZipTax as-is (existing behavior), return CalculateCartResponse
            4. Return type annotation: Union[CalculateCartResponse, TaxCloudCalculateCartResponse]
        operation_id: "calculateCart"
        routing:
          condition: "config.has_taxcloud_config"
          when_true:
            api: "taxcloud"
            path: "/tax/connections/{connectionId}/carts"
            http_method: "POST"
            http_client: "taxcloud_http_client"
            returns:
              type: "TaxCloudCalculateCartResponse"
              status_code: 200
            request_transformation:
              description: |
                The SDK must transform the CalculateCartRequest into the
                TaxCloud request format before sending. The transformation
                maps the ZipTax-style request to TaxCloud's expected schema.
              steps:
                - field: "items[].destination"
                  from: "CartAddress (single string: address)"
                  to: "TaxCloudAddress (structured: line1, city, state, zip, countryCode)"
                  note: |
                    Parse the single address string into structured components.
                    Use a simple parsing strategy:
                      - Split the address string by comma
                      - line1 = first segment (street address)
                      - city = second segment
                      - Parse last segment for state and zip (e.g., "CA 92618" or "CA 92618-1905")
                      - countryCode defaults to "US"
                    If parsing fails, raise a ZipTaxValidationError with a
                    descriptive message advising the user to provide a properly
                    formatted address string.
                - field: "items[].origin"
                  from: "CartAddress (single string: address)"
                  to: "TaxCloudAddress (structured: line1, city, state, zip, countryCode)"
                  note: "Same parsing logic as destination"
                - field: "items[].line_items[].taxability_code"
                  from: "taxabilityCode (Optional[int])"
                  to: "tic (int, defaults to 0)"
                  note: "Map taxabilityCode to TaxCloud's tic field. If None, use 0."
                - field: "items[].line_items[].index"
                  from: "(not present in CalculateCartRequest)"
                  to: "index (int, required by TaxCloud)"
                  note: "Auto-generate index from the line item's position in the array (0-based)"
                - field: "items[].currency.currency_code"
                  from: "Literal['USD']"
                  to: "currencyCode (string, 'USD' or 'CAD')"
                  note: "Pass through as-is; both APIs accept USD"
                - field: "transactionDate"
                  from: "(not present in CalculateCartRequest)"
                  to: "transactionDate (optional RFC3339 datetime)"
                  note: "Not included in the transformed request; TaxCloud defaults to now"
          when_false:
            api: "ziptax"
            path: "/calculate/cart"
            http_method: "POST"
            http_client: "http_client"
            returns:
              type: "CalculateCartResponse"
              status_code: 200
        parameters: []
        request_body:
          type: "CalculateCartRequest"
          description: "Cart with line items, addresses, and currency for tax calculation. Same input contract regardless of backend routing."
        returns:
          type: "Union[CalculateCartResponse, TaxCloudCalculateCartResponse]"
          is_array: false
          status_code: 200
          note: "Return type depends on whether TaxCloud is configured. See routing section."
        authentication:
          type: "header"
          header: "X-API-Key"
          format: "{apiKey} or {taxCloudAPIKey}"
          note: "Authentication header is determined by which HTTP client is used. ZipTax http_client uses ZipTax API key; TaxCloud taxcloud_http_client uses TaxCloud API key. Both are already configured on their respective HTTP client instances."
        validation:
          cart:
            - "items array must contain exactly 1 cart element"
            - "currency.currencyCode must be 'USD'"
            - "customerId is required (string)"
            - "destination.address is required (string)"
            - "origin.address is required (string)"
          line_items:
            - "Minimum: 1 line item"
            - "Maximum: 250 line items per cart"
            - "itemId: required (string)"
            - "price: required (positive decimal, greater than 0)"
            - "quantity: required (positive decimal, greater than 0, supports fractional values)"
            - "taxabilityCode: optional (integer, mapped to tic for TaxCloud, passed to v60 for ZipTax)"
        tax_calculation:
          formula: "taxAmount = (price x quantity) x taxRate"
          rounding: "5 decimal places for both taxRate and taxAmount (ZipTax); API-determined for TaxCloud"
          note: |
            Tax calculation and origin/destination sourcing resolution are
            performed by the respective API, not by the SDK.
            The SDK sends the cart request and returns the response.
          example: |
            price = 10.75
            quantity = 1.5
            taxRate = 0.09025
            taxAmount = (10.75 x 1.5) x 0.09025 = 1.45528
        errors:
          400:
            - "Invalid request format"
            - "Missing required fields"
            - "Cart exceeds 250 line items"
            - "More than one cart in request"
            - "Address parsing failed (TaxCloud route only)"
          401:
            - "Missing X-API-KEY header"
            - "Invalid or inactive API key"
          403:
            - "Forbidden (TaxCloud only)"
          422:
            - "Unprocessable Entity (TaxCloud only)"
          429:
            - "Too Many Requests (TaxCloud only)"
          500:
            - "Failed to calculate tax rate"
            - "v60 API error (ZipTax only)"
            - "Internal server error"

      # TaxCloud API Orders Endpoints
      - name: "CreateOrder"
        api: "taxcloud"  # Indicates this uses the TaxCloud API
        http_method: "POST"
        path: "/tax/connections/{connectionId}/orders"
        description: "Create orders from marketplace transactions, pre-existing systems, or bulk uploads. Requires TaxCloud Connection ID and API Key configured during client initialization."
        operation_id: "createOrder"
        requires_taxcloud: true  # This endpoint requires TaxCloud credentials
        parameters:
          - name: "connectionId"
            type: "string"
            format: "uuid"
            required: true
            location: "path"
            description: "TaxCloud Connection ID (automatically populated from client configuration)"
            example: "25eb9b97-5acb-492d-b720-c03e79cf715a"
          - name: "addressAutocomplete"
            type: "string"
            required: false
            location: "query"
            description: "The specified addresses will be overridden with first result from address validation search"
            default: "none"
            enum: ["none", "origin", "destination", "all"]
        request_body:
          type: "CreateOrderRequest"
          description: "Order details including line items, addresses, and tax information"
        returns:
          type: "OrderResponse"
          is_array: false
          status_code: 201
        authentication:
          type: "header"
          header: "X-API-KEY"
          format: "{taxCloudAPIKey}"
          note: "Uses TaxCloud API Key configured during client initialization"

      - name: "GetOrder"
        api: "taxcloud"  # Indicates this uses the TaxCloud API
        http_method: "GET"
        path: "/tax/connections/{connectionId}/orders/{orderId}"
        description: "Retrieve a specific order by its ID from TaxCloud. Requires TaxCloud Connection ID and API Key configured during client initialization."
        operation_id: "getOrder"
        requires_taxcloud: true  # This endpoint requires TaxCloud credentials
        parameters:
          - name: "connectionId"
            type: "string"
            format: "uuid"
            required: true
            location: "path"
            description: "TaxCloud Connection ID (automatically populated from client configuration)"
            example: "25eb9b97-5acb-492d-b720-c03e79cf715a"
          - name: "orderId"
            type: "string"
            required: true
            location: "path"
            description: "The ID of the order to retrieve (order ID from external system)"
            example: "my-order-1"
        returns:
          type: "OrderResponse"
          is_array: false
          status_code: 200
        authentication:
          type: "header"
          header: "X-API-KEY"
          format: "{taxCloudAPIKey}"
          note: "Uses TaxCloud API Key configured during client initialization"

      - name: "UpdateOrder"
        api: "taxcloud"  # Indicates this uses the TaxCloud API
        http_method: "PATCH"
        path: "/tax/connections/{connectionId}/orders/{orderId}"
        description: "Update an existing order's completedDate in TaxCloud. Use this endpoint to change when an order was shipped/completed. Requires TaxCloud Connection ID and API Key configured during client initialization."
        operation_id: "updateOrder"
        requires_taxcloud: true  # This endpoint requires TaxCloud credentials
        parameters:
          - name: "connectionId"
            type: "string"
            format: "uuid"
            required: true
            location: "path"
            description: "TaxCloud Connection ID (automatically populated from client configuration)"
            example: "25eb9b97-5acb-492d-b720-c03e79cf715a"
          - name: "orderId"
            type: "string"
            required: true
            location: "path"
            description: "The ID of the order to update (order ID from external system)"
            example: "my-order-1"
        request_body:
          type: "UpdateOrderRequest"
          description: "Update order details (currently only completedDate can be updated)"
        returns:
          type: "OrderResponse"
          is_array: false
          status_code: 200
        authentication:
          type: "header"
          header: "X-API-KEY"
          format: "{taxCloudAPIKey}"
          note: "Uses TaxCloud API Key configured during client initialization"

      # TaxCloud API Refunds Endpoint
      - name: "RefundOrder"
        api: "taxcloud"  # Indicates this uses the TaxCloud API
        http_method: "POST"
        path: "/tax/connections/{connectionId}/orders/refunds/{orderId}"
        description: "Create a refund against an order in TaxCloud. An order can only be refunded once, regardless of whether the order is partially or fully refunded. Requires TaxCloud Connection ID and API Key configured during client initialization."
        operation_id: "refundOrder"
        requires_taxcloud: true  # This endpoint requires TaxCloud credentials
        parameters:
          - name: "connectionId"
            type: "string"
            format: "uuid"
            required: true
            location: "path"
            description: "TaxCloud Connection ID (automatically populated from client configuration)"
            example: "25eb9b97-5acb-492d-b720-c03e79cf715a"
          - name: "orderId"
            type: "string"
            required: true
            location: "path"
            description: "The ID of the order to refund against"
            example: "my-order-1"
        request_body:
          type: "RefundTransactionRequest"
          description: "Refund details including items to refund (empty or omitted items means full refund)"
        returns:
          type: "array"
          items_type: "RefundTransactionResponse"
          is_array: true
          status_code: 201
        authentication:
          type: "header"
          header: "X-API-KEY"
          format: "{taxCloudAPIKey}"
          note: "Uses TaxCloud API Key configured during client initialization"

# -----------------------------------------------------------------------------
# Data Models
# -----------------------------------------------------------------------------
# Define the data structures/models used in the API
#
# IMPORTANT IMPLEMENTATION NOTES:
# 1. Use Pydantic v2 with ConfigDict (not deprecated Config class)
# 2. API returns camelCase fields - use Field aliases for snake_case SDK fields
# 3. Many fields are OPTIONAL in real responses despite appearing required
# 4. Jurisdiction names (jurName) contain actual values like "CA", "ORANGE" - NOT enums
# 5. See "actual_api_responses" section below for real response structures
models:
  # ---------------------------------------------------------------------------
  # API Version 6.0 Models (Latest)
  # ---------------------------------------------------------------------------
  - name: "V60Response"
    description: "Response for v6.0 API - structured format with separate components"
    properties:
      - name: "metadata"
        type: "V60Metadata"
        required: true
        description: "Response metadata"
      - name: "base_rates"
        type: "array"
        items_type: "V60BaseRate"
        required: false  # Can be null/missing
        api_field: "baseRates"  # API uses camelCase
        description: "Base tax rates by jurisdiction"
      - name: "service"
        type: "V60Service"
        required: true
        description: "Service taxability information"
      - name: "shipping"
        type: "V60Shipping"
        required: true
        description: "Shipping taxability information"
      - name: "sourcing_rules"
        type: "V60SourcingRules"
        required: false  # Can be null/missing
        api_field: "sourcingRules"  # IMPORTANT: API field is 'sourcingRules' not 'originDestination'
        description: "Sourcing rules (origin vs destination)"
      - name: "tax_summaries"
        type: "array"
        items_type: "V60TaxSummary"
        required: false  # Can be null/missing
        api_field: "taxSummaries"  # API uses camelCase
        description: "Tax rate summaries"
      - name: "addressDetail"
        type: "V60AddressDetail"
        required: true
        api_field: "addressDetail"  # API keeps this as camelCase (no snake_case conversion)
        description: "Address details"

  - name: "V60Metadata"
    description: "Metadata for v6.0 response"
    properties:
      - name: "version"
        type: "string"
        required: true
        description: "API version"
        example: "v60"
      - name: "response"
        type: "V60ResponseInfo"
        required: true
        description: "Response information (NESTED OBJECT - not flat)"

  - name: "V60ResponseInfo"
    description: "Response information nested in metadata"
    properties:
      - name: "code"
        type: "integer"
        format: "int64"
        required: true
        description: "Response code (100=success)"
        example: 100
      - name: "name"
        type: "string"
        required: true
        description: "Response code name"
        example: "RESPONSE_CODE_SUCCESS"
      - name: "message"
        type: "string"
        required: true
        description: "Response message"
        example: "Successful API Request."
      - name: "definition"
        type: "string"
        required: true
        description: "Schema definition URL"
        example: "http://api.zip-tax.com/request/v60/schema"

  - name: "V60BaseRate"
    description: "Base tax rate for a specific jurisdiction"
    properties:
      - name: "rate"
        type: "number"
        format: "float"
        required: true
        description: "Tax rate (decimal format, e.g., 0.0775 for 7.75%)"
      - name: "rate_id"
        type: "string"
        required: false  # OPTIONAL in real API responses
        api_field: "rateId"  # API uses camelCase
        description: "Rate identifier from tax table"
      - name: "jur_type"
        type: "string"  # STRING not enum - API may return various types
        required: true
        api_field: "jurType"  # API uses camelCase
        description: "Jurisdiction type (e.g., US_STATE_SALES_TAX, US_COUNTY_SALES_TAX)"
        example: "US_STATE_SALES_TAX"
      - name: "jur_name"
        type: "string"  # STRING not enum - contains actual names like "CA", "ORANGE"
        required: true
        api_field: "jurName"  # API uses camelCase
        description: "Actual jurisdiction name (e.g., 'CA', 'ORANGE', 'IRVINE')"
        example: "CA"
      - name: "jur_description"
        type: "string"
        required: false  # OPTIONAL in real API responses
        api_field: "jurDescription"  # API uses camelCase
        description: "Human-readable jurisdiction description"
        example: "US State Sales Tax"
      - name: "jur_tax_code"
        type: "string"
        required: false  # OPTIONAL in real API responses
        api_field: "jurTaxCode"  # API uses camelCase
        description: "Tax code for jurisdiction"
        example: "06"

  - name: "V60Service"
    description: "Service taxability information"
    properties:
      - name: "adjustment_type"
        type: "string"
        required: true
        api_field: "adjustmentType"  # API uses camelCase
        description: "Service adjustment type"
        example: "SERVICE_TAXABLE"
      - name: "taxable"
        type: "string"
        required: true
        description: "Taxability indicator"
        enum: ["Y", "N"]
      - name: "description"
        type: "string"
        required: true
        description: "Service description"

  - name: "V60Shipping"
    description: "Shipping taxability information"
    properties:
      - name: "adjustment_type"
        type: "string"
        required: true
        api_field: "adjustmentType"  # API uses camelCase
        description: "Shipping adjustment type"
        example: "FREIGHT_TAXABLE"
      - name: "taxable"
        type: "string"
        required: true
        description: "Taxability indicator"
        enum: ["Y", "N"]
      - name: "description"
        type: "string"
        required: true
        description: "Shipping description"

  - name: "V60SourcingRules"
    description: "Sourcing rules (origin vs destination) - API field is 'sourcingRules'"
    api_field: "sourcingRules"  # IMPORTANT: Not 'originDestination'
    properties:
      - name: "adjustment_type"
        type: "string"
        required: true
        api_field: "adjustmentType"  # API uses camelCase
        description: "Sourcing rules type"
        example: "ORIGIN_DESTINATION"
      - name: "description"
        type: "string"
        required: true
        description: "Sourcing rules description"
        example: "Destination Based Taxation"
      - name: "value"
        type: "string"
        required: true
        description: "Origin/destination indicator"
        enum: ["O", "D"]

  - name: "V60TaxSummary"
    description: "Tax rate summary"
    properties:
      - name: "rate"
        type: "number"
        format: "float"
        required: true
        description: "Summary tax rate"
      - name: "tax_type"
        type: "string"  # STRING not strict enum
        required: true
        api_field: "taxType"  # API uses camelCase
        description: "Tax type (e.g., SALES_TAX, USE_TAX)"
        example: "SALES_TAX"
      - name: "summary_name"
        type: "string"
        required: true
        api_field: "summaryName"  # API uses camelCase
        description: "Summary description"
        example: "Total Base Sales Tax"
      - name: "display_rates"
        type: "array"
        items_type: "V60DisplayRate"
        required: true
        api_field: "displayRates"  # API uses camelCase
        description: "Array of display rate breakdowns"

  - name: "V60DisplayRate"
    description: "Display rate breakdown within tax summary"
    properties:
      - name: "name"
        type: "string"
        required: true
        description: "Display rate name"
        example: "Total Rate"
      - name: "rate"
        type: "number"
        format: "float"
        required: true
        description: "Display rate value"
        example: 0.0775

  - name: "V60AddressDetail"
    description: "Address detail information for v6.0"
    properties:
      - name: "normalizedAddress"
        type: "string"
        required: true
        description: "Normalized address"
      - name: "incorporated"
        type: "string"
        required: true
        description: "Incorporation status"
        enum: ["true", "false"]
      - name: "geoLat"
        type: "number"
        format: "float"
        required: true
        description: "Geocoded latitude"
      - name: "geoLng"
        type: "number"
        format: "float"
        required: true
        description: "Geocoded longitude"
  - name: "V60AccountMetrics"
    description: "Account metrics by API key"
    notes: "Uses extra='allow' to accept additional fields the API may return."
    properties:
      - name: "request_count"
        type: "integer"
        format: "int64"
        required: true
        description: "Number of API requests made"
      - name: "request_limit"
        type: "integer"
        format: "int64"
        required: true
        description: "Maximum allowed API requests"
      - name: "usage_percent"
        type: "number"
        format: "float"
        required: true
        description: "Percentage of request limit used"
      - name: "is_active"
        type: "boolean"
        required: true
        description: "Whether the account is currently active"
      - name: "message"
        type: "string"
        required: true
        description: "Account status or informational message"

  # ---------------------------------------------------------------------------
  # Postal Code Lookup Models
  # ---------------------------------------------------------------------------
  - name: "V60PostalCodeResponse"
    description: "Response for postal code lookup - returns flat structure with multiple results"
    properties:
      - name: "version"
        type: "string"
        required: true
        description: "API version"
        example: "v60"
      - name: "r_code"
        type: "integer"
        format: "int64"
        required: true
        api_field: "rCode"
        description: "Response code (100=success)"
        example: 100
      - name: "results"
        type: "array"
        items_type: "V60PostalCodeResult"
        required: true
        description: "Array of tax rate results for the postal code"
      - name: "address_detail"
        type: "V60PostalCodeAddressDetail"
        required: true
        api_field: "addressDetail"
        description: "Address details for postal code lookup"

  - name: "V60PostalCodeResult"
    description: "Individual tax rate result for a postal code location"
    properties:
      - name: "geo_postal_code"
        type: "string"
        required: true
        api_field: "geoPostalCode"
        description: "Postal code"
      - name: "geo_city"
        type: "string"
        required: true
        api_field: "geoCity"
        description: "City name"
      - name: "geo_county"
        type: "string"
        required: true
        api_field: "geoCounty"
        description: "County name"
      - name: "geo_state"
        type: "string"
        required: true
        api_field: "geoState"
        description: "State code"
      - name: "tax_sales"
        type: "number"
        format: "float"
        required: true
        api_field: "taxSales"
        description: "Total sales tax rate"
      - name: "tax_use"
        type: "number"
        format: "float"
        required: true
        api_field: "taxUse"
        description: "Total use tax rate"
      - name: "txb_service"
        type: "string"
        required: true
        api_field: "txbService"
        description: "Service taxability indicator"
        enum: ["Y", "N"]
      - name: "txb_freight"
        type: "string"
        required: true
        api_field: "txbFreight"
        description: "Freight taxability indicator"
        enum: ["Y", "N"]
      - name: "state_sales_tax"
        type: "number"
        format: "float"
        required: true
        api_field: "stateSalesTax"
        description: "State sales tax rate"
      - name: "state_use_tax"
        type: "number"
        format: "float"
        required: true
        api_field: "stateUseTax"
        description: "State use tax rate"
      - name: "city_sales_tax"
        type: "number"
        format: "float"
        required: true
        api_field: "citySalesTax"
        description: "City sales tax rate"
      - name: "city_use_tax"
        type: "number"
        format: "float"
        required: true
        api_field: "cityUseTax"
        description: "City use tax rate"
      - name: "city_tax_code"
        type: "string"
        required: true
        api_field: "cityTaxCode"
        description: "City tax code"
      - name: "county_sales_tax"
        type: "number"
        format: "float"
        required: true
        api_field: "countySalesTax"
        description: "County sales tax rate"
      - name: "county_use_tax"
        type: "number"
        format: "float"
        required: true
        api_field: "countyUseTax"
        description: "County use tax rate"
      - name: "county_tax_code"
        type: "string"
        required: true
        api_field: "countyTaxCode"
        description: "County tax code"
      - name: "district_sales_tax"
        type: "number"
        format: "float"
        required: true
        api_field: "districtSalesTax"
        description: "Total district sales tax rate"
      - name: "district_use_tax"
        type: "number"
        format: "float"
        required: true
        api_field: "districtUseTax"
        description: "Total district use tax rate"
      - name: "district1_code"
        type: "string"
        required: true
        api_field: "district1Code"
        description: "District 1 tax code"
      - name: "district1_sales_tax"
        type: "number"
        format: "float"
        required: true
        api_field: "district1SalesTax"
        description: "District 1 sales tax rate"
      - name: "district1_use_tax"
        type: "number"
        format: "float"
        required: true
        api_field: "district1UseTax"
        description: "District 1 use tax rate"
      - name: "district2_code"
        type: "string"
        required: true
        api_field: "district2Code"
        description: "District 2 tax code"
      - name: "district2_sales_tax"
        type: "number"
        format: "float"
        required: true
        api_field: "district2SalesTax"
        description: "District 2 sales tax rate"
      - name: "district2_use_tax"
        type: "number"
        format: "float"
        required: true
        api_field: "district2UseTax"
        description: "District 2 use tax rate"
      - name: "district3_code"
        type: "string"
        required: true
        api_field: "district3Code"
        description: "District 3 tax code"
      - name: "district3_sales_tax"
        type: "number"
        format: "float"
        required: true
        api_field: "district3SalesTax"
        description: "District 3 sales tax rate"
      - name: "district3_use_tax"
        type: "number"
        format: "float"
        required: true
        api_field: "district3UseTax"
        description: "District 3 use tax rate"
      - name: "district4_code"
        type: "string"
        required: true
        api_field: "district4Code"
        description: "District 4 tax code"
      - name: "district4_sales_tax"
        type: "number"
        format: "float"
        required: true
        api_field: "district4SalesTax"
        description: "District 4 sales tax rate"
      - name: "district4_use_tax"
        type: "number"
        format: "float"
        required: true
        api_field: "district4UseTax"
        description: "District 4 use tax rate"
      - name: "district5_code"
        type: "string"
        required: true
        api_field: "district5Code"
        description: "District 5 tax code"
      - name: "district5_sales_tax"
        type: "number"
        format: "float"
        required: true
        api_field: "district5SalesTax"
        description: "District 5 sales tax rate"
      - name: "district5_use_tax"
        type: "number"
        format: "float"
        required: true
        api_field: "district5UseTax"
        description: "District 5 use tax rate"
      - name: "origin_destination"
        type: "string"
        required: true
        api_field: "originDestination"
        description: "Origin/destination indicator"
        enum: ["O", "D"]

  - name: "V60PostalCodeAddressDetail"
    description: "Address details for postal code lookup"
    properties:
      - name: "normalized_address"
        type: "string"
        required: true
        api_field: "normalizedAddress"
        description: "Normalized address (not available for postal code lookups)"
      - name: "incorporated"
        type: "string"
        required: true
        description: "Incorporation status (not available for postal code lookups)"
      - name: "geo_lat"
        type: "number"
        format: "float"
        required: true
        api_field: "geoLat"
        description: "Latitude (0 for postal code lookups)"
      - name: "geo_lng"
        type: "number"
        format: "float"
        required: true
        api_field: "geoLng"
        description: "Longitude (0 for postal code lookups)"

  # ---------------------------------------------------------------------------
  # ZipTax Cart Tax Calculation Models
  # ---------------------------------------------------------------------------
  - name: "CalculateCartRequest"
    description: "Request payload for calculating sales tax on a shopping cart. Wraps a single cart item in an 'items' array."
    api: "ziptax"
    properties:
      - name: "items"
        type: "array"
        items_type: "CartItem"
        required: true
        description: "Array of cart items (must contain exactly 1 element)"
        validation:
          min_items: 1
          max_items: 1

  - name: "CartItem"
    description: "A single cart containing customer info, addresses, currency, and line items for tax calculation"
    api: "ziptax"
    properties:
      - name: "customer_id"
        type: "string"
        required: true
        api_field: "customerId"
        description: "Customer identifier"
        example: "customer-453"
      - name: "currency"
        type: "CartCurrency"
        required: true
        description: "Currency information (must be USD)"
      - name: "destination"
        type: "CartAddress"
        required: true
        description: "Destination address used for tax calculation"
      - name: "origin"
        type: "CartAddress"
        required: true
        description: "Origin address of the seller/shipper"
      - name: "line_items"
        type: "array"
        items_type: "CartLineItem"
        required: true
        api_field: "lineItems"
        description: "Array of line items in the cart (1-250 items)"
        validation:
          min_items: 1
          max_items: 250

  - name: "CartAddress"
    description: "Simple address structure for cart tax calculation (single string format)"
    api: "ziptax"
    properties:
      - name: "address"
        type: "string"
        required: true
        description: "Full address string for geocoding"
        example: "200 Spectrum Center Dr, Irvine, CA 92618-1905"

  - name: "CartCurrency"
    description: "Currency information for cart request"
    api: "ziptax"
    properties:
      - name: "currency_code"
        type: "string"
        required: true
        api_field: "currencyCode"
        description: "ISO currency code (must be USD)"
        enum: ["USD"]
        example: "USD"

  - name: "CartLineItem"
    description: "A line item in the cart request with product details for tax calculation"
    api: "ziptax"
    properties:
      - name: "item_id"
        type: "string"
        required: true
        api_field: "itemId"
        description: "Unique identifier for the line item"
        example: "item-1"
      - name: "price"
        type: "number"
        format: "float"
        required: true
        description: "Unit price of the item (must be positive, greater than 0)"
        example: 10.75
        validation:
          exclusive_minimum: 0
      - name: "quantity"
        type: "number"
        format: "float"
        required: true
        description: "Quantity of the item (must be positive, greater than 0, supports fractional values for items sold by weight)"
        example: 1.5
        validation:
          exclusive_minimum: 0
      - name: "taxability_code"
        type: "integer"
        format: "int64"
        required: false
        api_field: "taxabilityCode"
        description: "Taxability code for product-specific tax rules (passed to v60 tax engine if provided)"
        example: 0

  - name: "CalculateCartResponse"
    description: "Response from cart tax calculation containing per-item tax details"
    api: "ziptax"
    properties:
      - name: "items"
        type: "array"
        items_type: "CartItemResponse"
        required: true
        description: "Array of cart results (mirrors request items array order)"

  - name: "CartItemResponse"
    description: "A single cart response with calculated tax information per line item"
    api: "ziptax"
    properties:
      - name: "cart_id"
        type: "string"
        format: "uuid"
        required: true
        api_field: "cartId"
        description: "Server-generated UUID identifying this cart calculation"
        example: "ce4a...ccefdd"
      - name: "customer_id"
        type: "string"
        required: true
        api_field: "customerId"
        description: "Customer identifier (echoed from request)"
        example: "customer-453"
      - name: "destination"
        type: "CartAddress"
        required: true
        description: "Destination address (echoed from request)"
      - name: "origin"
        type: "CartAddress"
        required: true
        description: "Origin address (echoed from request)"
      - name: "line_items"
        type: "array"
        items_type: "CartLineItemResponse"
        required: true
        api_field: "lineItems"
        description: "Array of line items with calculated tax information"

  - name: "CartLineItemResponse"
    description: "A line item in the cart response with calculated tax rate and amount"
    api: "ziptax"
    properties:
      - name: "item_id"
        type: "string"
        required: true
        api_field: "itemId"
        description: "Unique identifier for the line item (echoed from request)"
        example: "item-1"
      - name: "price"
        type: "number"
        format: "float"
        required: true
        description: "Unit price of the item (echoed from request)"
        example: 10.75
      - name: "quantity"
        type: "number"
        format: "float"
        required: true
        description: "Quantity of the item (echoed from request)"
        example: 1.5
      - name: "tax"
        type: "CartTax"
        required: true
        description: "Calculated tax information for this line item"

  - name: "CartTax"
    description: "Calculated tax details for a cart line item"
    api: "ziptax"
    properties:
      - name: "rate"
        type: "number"
        format: "float"
        required: true
        description: "Calculated sales tax rate (rounded to 5 decimal places)"
        example: 0.09025
      - name: "amount"
        type: "number"
        format: "float"
        required: true
        description: "Calculated tax amount: (price x quantity) x rate (rounded to 5 decimal places)"
        example: 1.45528

  # ---------------------------------------------------------------------------
  # TaxCloud Cart Tax Calculation Models
  # ---------------------------------------------------------------------------
  # These models are used when CalculateCart routes to TaxCloud API.
  # The SDK transforms the shared CalculateCartRequest into the TaxCloud
  # request format internally, but these models define the TaxCloud
  # response structure returned to the caller.
  # ---------------------------------------------------------------------------

  - name: "TaxCloudCalculateCartResponse"
    description: |
      Response from TaxCloud cart tax calculation. Returned by CalculateCart
      when the client is configured with TaxCloud credentials. Contains the
      connectionId, transactionDate, and an array of cart results with
      TaxCloud-style structured addresses and line items with tax details.
    api: "taxcloud"
    properties:
      - name: "connection_id"
        type: "string"
        required: true
        api_field: "connectionId"
        description: "TaxCloud Connection ID used for this cart calculation"
        example: "25eb9b97-5acb-492d-b720-c03e79cf715a"
      - name: "items"
        type: "array"
        items_type: "TaxCloudCartResponse"
        required: true
        description: "Array of cart results with calculated tax information"
      - name: "transaction_date"
        type: "string"
        format: "date-time"
        required: true
        api_field: "transactionDate"
        description: "RFC3339 datetime string the cart was calculated for"
        example: "2024-01-15T09:30:00Z"

  - name: "TaxCloudCartResponse"
    description: "A single cart response from TaxCloud with calculated tax information per line item"
    api: "taxcloud"
    properties:
      - name: "cart_id"
        type: "string"
        required: true
        api_field: "cartId"
        description: "ID representing this cart. Auto-generated if not provided in the request."
        example: "ce4a1234-5678-90ab-cdef-1234567890ab"
      - name: "customer_id"
        type: "string"
        required: true
        api_field: "customerId"
        description: "Customer identifier (echoed from request)"
        example: "customer-453"
      - name: "currency"
        type: "CurrencyResponse"
        required: true
        description: "Currency information"
      - name: "delivered_by_seller"
        type: "boolean"
        required: true
        api_field: "deliveredBySeller"
        description: "Whether the seller directly delivered the order"
      - name: "destination"
        type: "TaxCloudAddressResponse"
        required: true
        description: "Destination address (structured format from TaxCloud)"
      - name: "origin"
        type: "TaxCloudAddressResponse"
        required: true
        description: "Origin address (structured format from TaxCloud)"
      - name: "exemption"
        type: "Exemption"
        required: true
        description: "Exemption information"
      - name: "line_items"
        type: "array"
        items_type: "TaxCloudCartLineItemResponse"
        required: true
        api_field: "lineItems"
        description: "Array of line items with calculated tax information"

  - name: "TaxCloudCartLineItemResponse"
    description: "A line item in the TaxCloud cart response with calculated tax rate and amount"
    api: "taxcloud"
    properties:
      - name: "index"
        type: "integer"
        format: "int64"
        required: true
        description: "Position/index of item within the cart (0-based)"
        example: 0
      - name: "item_id"
        type: "string"
        required: true
        api_field: "itemId"
        description: "Unique identifier for the line item (echoed from request)"
        example: "item-1"
      - name: "price"
        type: "number"
        format: "float"
        required: true
        description: "Unit price of the item (echoed from request)"
        example: 10.8
      - name: "quantity"
        type: "number"
        format: "float"
        required: true
        description: "Quantity of the item (echoed from request)"
        example: 1.5
      - name: "tax"
        type: "Tax"
        required: true
        description: "Calculated tax information for this line item (uses existing TaxCloud Tax model)"
      - name: "tic"
        type: "integer"
        format: "int64"
        required: true
        description: "Taxability Information Code (mapped from taxabilityCode, defaults to 0)"
        example: 0
        notes:
          - "This field is nullable in the API response (type: integer | null)"
          - "Use Optional[int] in the Pydantic model"

  # ---------------------------------------------------------------------------
  # TaxCloud API Models - Order Management
  # ---------------------------------------------------------------------------
  - name: "CreateOrderRequest"
    description: "Request payload for creating an order in TaxCloud"
    api: "taxcloud"
    properties:
      - name: "order_id"
        type: "string"
        required: true
        api_field: "orderId"
        description: "Order ID in external system"
        example: "my-order-1"
      - name: "customer_id"
        type: "string"
        required: true
        api_field: "customerId"
        description: "Customer ID in external system"
        example: "customer-453"
      - name: "transaction_date"
        type: "string"
        format: "date-time"
        required: true
        api_field: "transactionDate"
        description: "RFC3339 datetime string when order was purchased"
        example: "2024-01-15T09:30:00Z"
      - name: "completed_date"
        type: "string"
        format: "date-time"
        required: true
        api_field: "completedDate"
        description: "RFC3339 datetime string when order was shipped/completed (created tax liability)"
        example: "2024-01-15T09:30:00Z"
      - name: "origin"
        type: "TaxCloudAddress"
        required: true
        description: "Origin address of the order"
      - name: "destination"
        type: "TaxCloudAddress"
        required: true
        description: "Destination address of the order"
      - name: "line_items"
        type: "array"
        items_type: "CartItemWithTax"
        required: true
        api_field: "lineItems"
        description: "Array of line items in the order with tax calculations"
      - name: "currency"
        type: "Currency"
        required: true
        description: "Currency information for the order"
      - name: "channel"
        type: "string"
        required: false
        description: "Sales channel (e.g., amazon, ebay, walmart) for tax exclusion rules"
        example: "amazon"
      - name: "delivered_by_seller"
        type: "boolean"
        required: false
        api_field: "deliveredBySeller"
        description: "Whether the seller directly delivered the order"
      - name: "exclude_from_filing"
        type: "boolean"
        required: false
        api_field: "excludeFromFiling"
        description: "Whether to exclude this order from tax filing"
        default: false
      - name: "exemption"
        type: "Exemption"
        required: false
        description: "Exemption certificate information for the order"

  - name: "OrderResponse"
    description: "Response after successfully creating an order in TaxCloud"
    api: "taxcloud"
    properties:
      - name: "order_id"
        type: "string"
        required: true
        api_field: "orderId"
        description: "Order ID in external system"
      - name: "customer_id"
        type: "string"
        required: true
        api_field: "customerId"
        description: "Customer ID in external system"
      - name: "connection_id"
        type: "string"
        required: true
        api_field: "connectionId"
        description: "TaxCloud connection ID used for this order"
      - name: "transaction_date"
        type: "string"
        format: "date-time"
        required: true
        api_field: "transactionDate"
        description: "RFC3339 datetime string when order was purchased"
      - name: "completed_date"
        type: "string"
        format: "date-time"
        required: true
        api_field: "completedDate"
        description: "RFC3339 datetime string when order was shipped/completed"
      - name: "origin"
        type: "TaxCloudAddressResponse"
        required: true
        description: "Origin address of the order"
      - name: "destination"
        type: "TaxCloudAddressResponse"
        required: true
        description: "Destination address of the order"
      - name: "line_items"
        type: "array"
        items_type: "CartItemWithTaxResponse"
        required: true
        api_field: "lineItems"
        description: "Array of line items with tax calculations"
      - name: "currency"
        type: "CurrencyResponse"
        required: true
        description: "Currency information"
      - name: "channel"
        type: "string"
        required: true
        description: "Sales channel for the order"
      - name: "delivered_by_seller"
        type: "boolean"
        required: true
        api_field: "deliveredBySeller"
        description: "Whether seller directly delivered the order"
      - name: "exclude_from_filing"
        type: "boolean"
        required: true
        default: false
        api_field: "excludeFromFiling"
        description: "Whether order is excluded from tax filing"
      - name: "exemption"
        type: "Exemption"
        required: true
        description: "Exemption information"

  - name: "TaxCloudAddress"
    description: "Address structure for TaxCloud orders"
    api: "taxcloud"
    properties:
      - name: "line1"
        type: "string"
        required: true
        description: "First line of address (street, PO Box, or building)"
        example: "323 Washington Ave N"
      - name: "line2"
        type: "string"
        required: false
        description: "Second line of address (apartment or suite number)"
      - name: "city"
        type: "string"
        required: true
        description: "City or post-town"
        example: "Minneapolis"
      - name: "state"
        type: "string"
        required: true
        description: "State, province, county or large territorial division"
        example: "MN"
      - name: "zip"
        type: "string"
        required: true
        description: "Postal or ZIP code"
        example: "55401-2427"
      - name: "country_code"
        type: "string"
        required: false
        api_field: "countryCode"
        description: "ISO 3166-1 alpha-2 country code"
        default: "US"
        enum: ["US", "CA"]

  - name: "TaxCloudAddressResponse"
    description: "Address response structure from TaxCloud"
    api: "taxcloud"
    properties:
      - name: "line1"
        type: "string"
        required: true
        description: "First line of address"
      - name: "line2"
        type: "string"
        required: false
        description: "Second line of address"
      - name: "city"
        type: "string"
        required: true
        description: "City or post-town"
      - name: "state"
        type: "string"
        required: true
        description: "State abbreviation"
      - name: "zip"
        type: "string"
        required: true
        description: "Postal or ZIP code"
      - name: "country_code"
        type: "string"
        required: true
        default: "US"
        api_field: "countryCode"
        description: "ISO 3166-1 alpha-2 country code"

  - name: "CartItemWithTax"
    description: "Cart line item with tax calculation for order creation"
    api: "taxcloud"
    properties:
      - name: "index"
        type: "integer"
        format: "int64"
        required: true
        description: "Position/index of item within the cart"
        example: 0
      - name: "item_id"
        type: "string"
        required: true
        api_field: "itemId"
        description: "Unique identifier for the cart item"
        example: "item-1"
      - name: "price"
        type: "number"
        format: "float"
        required: true
        description: "Unit price of the item"
        example: 10.8
      - name: "quantity"
        type: "number"
        format: "float"
        required: true
        description: "Quantity of the item"
        example: 1.5
      - name: "tax"
        type: "Tax"
        required: true
        description: "Tax information for the item"
      - name: "product_id"
        type: "string"
        required: false
        api_field: "productId"
        description: "Product ID from product catalog (must match existing product)"
      - name: "tic"
        type: "integer"
        format: "int64"
        required: false
        description: "Taxability Information Code (defaults to 0 if not provided)"
        default: 0

  - name: "CartItemWithTaxResponse"
    description: "Cart line item response from TaxCloud"
    api: "taxcloud"
    properties:
      - name: "index"
        type: "integer"
        format: "int64"
        required: true
        description: "Position/index of item within the cart"
      - name: "item_id"
        type: "string"
        required: true
        api_field: "itemId"
        description: "Unique identifier for the cart item"
      - name: "price"
        type: "number"
        format: "float"
        required: true
        description: "Unit price of the item"
      - name: "quantity"
        type: "number"
        format: "float"
        required: true
        description: "Quantity of the item"
      - name: "tax"
        type: "Tax"
        required: true
        description: "Tax information for the item"
      - name: "tic"
        type: "integer"
        format: "int64"
        required: true
        description: "Taxability Information Code"

  - name: "Tax"
    description: "Tax calculation details for a cart item"
    api: "taxcloud"
    properties:
      - name: "amount"
        type: "number"
        format: "float"
        required: true
        description: "Tax amount calculated for the item"
        example: 1.31
      - name: "rate"
        type: "number"
        format: "float"
        required: true
        description: "Tax rate applied (decimal format)"
        example: 0.0813

  - name: "Currency"
    description: "Currency information for order"
    api: "taxcloud"
    properties:
      - name: "currency_code"
        type: "string"
        required: false
        api_field: "currencyCode"
        description: "ISO currency code"
        default: "USD"
        enum: ["USD", "CAD"]

  - name: "CurrencyResponse"
    description: "Currency response from TaxCloud"
    api: "taxcloud"
    properties:
      - name: "currency_code"
        type: "string"
        required: true
        api_field: "currencyCode"
        description: "ISO currency code"

  - name: "Exemption"
    description: "Tax exemption certificate information"
    api: "taxcloud"
    properties:
      - name: "exemption_id"
        type: "string"
        required: false
        api_field: "exemptionId"
        description: "ID of exemption certificate used for customer (if provided, is_exempt assumed true)"
      - name: "is_exempt"
        type: "boolean"
        required: false
        api_field: "isExempt"
        description: "Whether customer is exempt from tax"

  - name: "UpdateOrderRequest"
    description: "Request payload for updating an order in TaxCloud (currently only completedDate can be updated)"
    api: "taxcloud"
    properties:
      - name: "completed_date"
        type: "string"
        format: "date-time"
        required: true
        api_field: "completedDate"
        description: "RFC3339 datetime string when order was shipped/completed (creates tax liability)"
        example: "2024-01-16T10:00:00Z"

  # ---------------------------------------------------------------------------
  # TaxCloud API Models - Refunds
  # ---------------------------------------------------------------------------
  - name: "RefundTransactionRequest"
    description: "Request payload for creating a refund against an order in TaxCloud"
    api: "taxcloud"
    properties:
      - name: "items"
        type: "array"
        items_type: "CartItemRefundWithTaxRequest"
        required: false
        description: "Items to refund. If empty list or omitted, entire order will be refunded"
      - name: "returned_date"
        type: "string"
        format: "date-time"
        required: false
        api_field: "returnedDate"
        description: "Include only if this return is a change to a previously filed sales tax return (triggers Amended Sales Tax Return - not typically recommended)"

  - name: "CartItemRefundWithTaxRequest"
    description: "Cart line item to be refunded"
    api: "taxcloud"
    properties:
      - name: "item_id"
        type: "string"
        required: true
        api_field: "itemId"
        description: "Unique identifier for the cart item to refund"
        example: "item-1"
      - name: "quantity"
        type: "number"
        format: "float"
        required: true
        description: "Quantity of the item to refund"
        example: 1.0

  - name: "RefundTransactionResponse"
    description: "Response after successfully creating a refund in TaxCloud"
    api: "taxcloud"
    properties:
      - name: "connection_id"
        type: "string"
        required: true
        api_field: "connectionId"
        description: "TaxCloud connection ID used for this refund"
      - name: "created_date"
        type: "string"
        format: "date-time"
        required: true
        api_field: "createdDate"
        description: "RFC3339 datetime string when the refund was created"
      - name: "items"
        type: "array"
        items_type: "CartItemRefundWithTaxResponse"
        required: true
        description: "Array of refunded line items with tax calculations"
      - name: "returned_date"
        type: "string"
        format: "date-time"
        required: false
        api_field: "returnedDate"
        description: "RFC3339 datetime string when the refund took effect"

  - name: "CartItemRefundWithTaxResponse"
    description: "Refunded cart line item response from TaxCloud"
    api: "taxcloud"
    properties:
      - name: "index"
        type: "integer"
        format: "int64"
        required: true
        description: "Position/index of item within the cart"
      - name: "item_id"
        type: "string"
        required: true
        api_field: "itemId"
        description: "Unique identifier for the cart item"
      - name: "price"
        type: "number"
        format: "float"
        required: true
        description: "Price of the refunded item"
      - name: "quantity"
        type: "number"
        format: "float"
        required: true
        description: "Quantity of the item refunded"
      - name: "tax"
        type: "RefundTax"
        required: true
        description: "Tax information for the refunded item"
      - name: "tic"
        type: "integer"
        format: "int64"
        required: false
        default: 0
        description: "Taxability Information Code"

  - name: "RefundTax"
    description: "Tax details for a refunded item"
    api: "taxcloud"
    properties:
      - name: "amount"
        type: "number"
        format: "float"
        required: true
        description: "Tax amount refunded for the item"
        example: 1.31


# -----------------------------------------------------------------------------
# Dependencies
# -----------------------------------------------------------------------------
dependencies:
  # Runtime dependencies
  runtime:
    - name: "requests"        # HTTP client library (language-specific)
      version: ">=2.28.0"
      purpose: "HTTP requests"
    - name: "pydantic"        # Data validation (language-specific)
      version: ">=2.0.0"
      purpose: "Data validation and models"

  # Development dependencies
  development:
    - name: "pytest"
      version: ">=7.0.0"
      purpose: "Testing framework"
    - name: "pytest-cov"
      version: ">=4.0.0"
      purpose: "Code coverage"
    - name: "black"
      version: ">=23.0.0"
      purpose: "Code formatting"
    - name: "mypy"
      version: ">=1.0.0"
      purpose: "Type checking"
    - name: "ruff"
      version: ">=0.1.0"
      purpose: "Linting"

# -----------------------------------------------------------------------------
# Project Structure
# -----------------------------------------------------------------------------
# Define the directory structure for the SDK
structure:
  root_files:
    - "README.md"
    - "LICENSE"
    - "setup.py"
    - ".gitignore"
    - "pyproject.toml"

  directories:
    - path: "src/ziptax"
      contents:
        - "__init__.py"
        - "client.py"
        - "config.py"
        - "exceptions.py"

    - path: "src/ziptax/resources"
      contents:
        - "__init__.py"
        - "functions.py"

    - path: "src/ziptax/models"
      contents:
        - "__init__.py"
        - "responses.py"

    - path: "src/ziptax/utils"
      contents:
        - "__init__.py"
        - "http.py"
        - "retry.py"
        - "validation.py"

    - path: "tests"
      contents:
        - "__init__.py"
        - "test_client.py"
        - "test_functions.py"
        - "test_http.py"      # REQUIRED: Tests for HTTPClient utility
        - "test_retry.py"     # REQUIRED: Tests for retry logic
        - "conftest.py"

    - path: "examples"
      contents:
        - "basic_usage.py"
        - "async_usage.py"
        - "error_handling.py"

    - path: "docs"
      contents:
        - "index.md"
        - "quickstart.md"
        - "api-reference.md"

# -----------------------------------------------------------------------------
# Code Generation Settings
# -----------------------------------------------------------------------------
code_generation:
  # Style guide compliance
  style:
    follow_language_conventions: true
    style_guide: "PEP 8"
    line_length: 88
    indent_size: 4
    indent_style: "spaces"

  # Documentation
  documentation:
    style: "google"
    include_examples: true
    include_type_info: true
    minimum_coverage: "public_api"

  # Testing
  testing:
    framework: "pytest"
    include_unit_tests: true
    include_integration_tests: true
    mock_api_responses: true
    target_coverage: 80

  # Code quality
  quality:
    include_linter_config: true
    include_formatter_config: true
    include_type_checker_config: true
    include_pre_commit_hooks: true

# -----------------------------------------------------------------------------
# Build & Distribution
# -----------------------------------------------------------------------------
build:
  # Build system
  system: "setuptools"

  # Build configuration
  output_directory: "dist"

  # Distribution
  distribution:
    platforms:
      - "pypi"

    # Package metadata
    classifiers:
      - "Development Status :: 4 - Beta"
      - "Intended Audience :: Developers"
      - "License :: OSI Approved :: MIT License"
      - "Programming Language :: Python :: 3"
      - "Programming Language :: Python :: 3.8"
      - "Programming Language :: Python :: 3.9"
      - "Programming Language :: Python :: 3.10"
      - "Programming Language :: Python :: 3.11"

    keywords:
      - "tax"
      - "ziptax"
      - "api"
      - "sdk"
      - "sales tax"

# -----------------------------------------------------------------------------
# Documentation
# -----------------------------------------------------------------------------
documentation:
  # Documentation tools
  generator: "sphinx"
  theme: "readthedocs"

  # Content requirements
  sections:
    - name: "Installation"
      required: true
    - name: "Quick Start"
      required: true
    - name: "Authentication"
      required: true
    - name: "API Reference"
      required: true
      auto_generate: true
    - name: "Error Handling"
      required: true
    - name: "Examples"
      required: true
    - name: "Contributing"
      required: false
    - name: "Changelog"
      required: true

  # API documentation
  api_docs:
    include_request_examples: true
    include_response_examples: true
    include_error_examples: true
    format: "markdown"

# -----------------------------------------------------------------------------
# Examples
# -----------------------------------------------------------------------------
examples:
  - name: "Basic Usage"
    file: "examples/basic_usage.py"
    description: "Simple example showing basic SDK initialization and usage"
    required: true

  - name: "Async Operations"
    file: "examples/async_usage.py"
    description: "Example using async/await for concurrent operations"
    required: false

  - name: "Error Handling"
    file: "examples/error_handling.py"
    description: "Demonstrates proper error handling patterns"
    required: true

  - name: "Pagination"
    file: "examples/pagination.py"
    description: "Working with paginated endpoints"
    required: false

# -----------------------------------------------------------------------------
# CI/CD Configuration
# -----------------------------------------------------------------------------
ci_cd:
  # Continuous Integration
  platform: "github_actions"

  workflows:
    - name: "Test"
      triggers: ["push", "pull_request"]
      jobs:
        - "lint"
        - "type-check"
        - "test"
        - "coverage"

    - name: "Publish"
      triggers: ["release"]
      jobs:
        - "build"
        - "publish"

  # Testing matrix
  test_matrix:
    python_versions: ["3.8", "3.9", "3.10", "3.11"]
    os: ["ubuntu-latest", "macos-latest", "windows-latest"]

# -----------------------------------------------------------------------------
# Additional Instructions
# -----------------------------------------------------------------------------
# Any special instructions or considerations for this SDK
instructions:
  special_considerations:
    - "Ensure all monetary values use appropriate decimal/currency types"
    - "ZIP codes should be validated for format"
    - "Date handling should respect timezone requirements"
    - "All API responses should be properly typed"

  # Code patterns to follow
  patterns:
    - pattern: "Config-based client initialization"
      example: |
        client = ZipTaxClient.api_key('xxx')
        client.config['format'] = 'json'
        client.request.GetSalesTaxByAddress("200 Spectrum Center Drive, Irvine, CA 92618")

    - pattern: "Resource-based method organization"
      example: "client.request.GetSalesTaxByAddress(address)"

    - pattern: "Consistent error handling"
      example: "try/except blocks with specific exception types"

  # Avoid these patterns
  anti_patterns:
    - "Don't use global state for configuration"
    - "Avoid bare except clauses"
    - "Don't ignore type hints in favor of dynamic typing"

# -----------------------------------------------------------------------------
# Actual API Response Examples
# -----------------------------------------------------------------------------
# CRITICAL: These are REAL API responses - use these to validate model structure
actual_api_responses:
  v60_tax_lookup:
    description: "Actual V60 response for GetSalesTaxByAddress"
    endpoint: "GET /request/v60/"
    example: |
      {
        "metadata": {
          "version": "v60",
          "response": {
            "code": 100,
            "name": "RESPONSE_CODE_SUCCESS",
            "message": "Successful API Request.",
            "definition": "http://api.zip-tax.com/request/v60/schema"
          }
        },
        "baseRates": [
          {
            "rate": 0.06,
            "jurType": "US_STATE_SALES_TAX",
            "jurName": "CA",
            "jurDescription": "US State Sales Tax",
            "jurTaxCode": "06"
          },
          {
            "rate": 0.0025,
            "jurType": "US_COUNTY_SALES_TAX",
            "jurName": "ORANGE",
            "jurDescription": "US County Sales Tax"
          },
          {
            "rate": 0.015,
            "jurType": "US_CITY_SALES_TAX",
            "jurName": "IRVINE"
          }
        ],
        "service": {
          "adjustmentType": "SERVICE_TAXABLE",
          "taxable": "N",
          "description": "Services non-taxable"
        },
        "shipping": {
          "adjustmentType": "FREIGHT_TAXABLE",
          "taxable": "N",
          "description": "Freight non-taxable"
        },
        "sourcingRules": {
          "adjustmentType": "ORIGIN_DESTINATION",
          "description": "Destination Based Taxation",
          "value": "D"
        },
        "taxSummaries": [
          {
            "rate": 0.0775,
            "taxType": "SALES_TAX",
            "summaryName": "Total Base Sales Tax",
            "displayRates": [
              {
                "name": "Total Rate",
                "rate": 0.0775
              }
            ]
          }
        ],
        "addressDetail": {
          "normalizedAddress": "200 Spectrum Center Dr, Irvine, CA 92618-5003, United States",
          "incorporated": "true",
          "geoLat": 33.65253,
          "geoLng": -117.74794
        }
      }

  v60_account_metrics:
    description: "Actual V60AccountMetrics response from live API"
    endpoint: "GET /account/v60/metrics"
    example: |
      {
        "request_count": 15595,
        "request_limit": 1000000,
        "usage_percent": 1.5595,
        "is_active": true,
        "message": "Contact support@zip.tax to modify your account"
      }

  v60_postal_code_lookup:
    description: "Actual V60 response for GetRatesByPostalCode"
    endpoint: "GET /request/v60/"
    example: |
      {
        "version": "v60",
        "rCode": 100,
        "results": [
          {
            "geoPostalCode": "92694",
            "geoCity": "LADERA RANCH",
            "geoCounty": "ORANGE",
            "geoState": "CA",
            "taxSales": 0.0775,
            "taxUse": 0.0775,
            "txbService": "N",
            "txbFreight": "N",
            "stateSalesTax": 0.06,
            "stateUseTax": 0.06,
            "citySalesTax": 0,
            "cityUseTax": 0,
            "cityTaxCode": "",
            "countySalesTax": 0.0025,
            "countyUseTax": 0.0025,
            "countyTaxCode": "",
            "districtSalesTax": 0.015,
            "districtUseTax": 0.015,
            "district1Code": "37",
            "district1SalesTax": 0,
            "district1UseTax": 0,
            "district2Code": "37",
            "district2SalesTax": 0.005,
            "district2UseTax": 0.005,
            "district3Code": "",
            "district3SalesTax": 0,
            "district3UseTax": 0,
            "district4Code": "30",
            "district4SalesTax": 0.01,
            "district4UseTax": 0.01,
            "district5Code": "",
            "district5SalesTax": 0,
            "district5UseTax": 0,
            "originDestination": "D"
          },
          {
            "geoPostalCode": "92694",
            "geoCity": "SAN JUAN CAPISTRANO",
            "geoCounty": "ORANGE",
            "geoState": "CA",
            "taxSales": 0.0775,
            "taxUse": 0.0775,
            "txbService": "N",
            "txbFreight": "N",
            "stateSalesTax": 0.06,
            "stateUseTax": 0.06,
            "citySalesTax": 0,
            "cityUseTax": 0,
            "cityTaxCode": "",
            "countySalesTax": 0.0025,
            "countyUseTax": 0.0025,
            "countyTaxCode": "",
            "districtSalesTax": 0.015,
            "districtUseTax": 0.015,
            "district1Code": "37",
            "district1SalesTax": 0,
            "district1UseTax": 0,
            "district2Code": "37",
            "district2SalesTax": 0.005,
            "district2UseTax": 0.005,
            "district3Code": "",
            "district3SalesTax": 0,
            "district3UseTax": 0,
            "district4Code": "30",
            "district4SalesTax": 0.01,
            "district4UseTax": 0.01,
            "district5Code": "",
            "district5SalesTax": 0,
            "district5UseTax": 0,
            "originDestination": "D"
          },
          {
            "geoPostalCode": "92694",
            "geoCity": "MISSION VIEJO",
            "geoCounty": "ORANGE",
            "geoState": "CA",
            "taxSales": 0.0775,
            "taxUse": 0.0775,
            "txbService": "N",
            "txbFreight": "N",
            "stateSalesTax": 0.06,
            "stateUseTax": 0.06,
            "citySalesTax": 0,
            "cityUseTax": 0,
            "cityTaxCode": "",
            "countySalesTax": 0.0025,
            "countyUseTax": 0.0025,
            "countyTaxCode": "",
            "districtSalesTax": 0.015,
            "districtUseTax": 0.015,
            "district1Code": "37",
            "district1SalesTax": 0,
            "district1UseTax": 0,
            "district2Code": "37",
            "district2SalesTax": 0.005,
            "district2UseTax": 0.005,
            "district3Code": "",
            "district3SalesTax": 0,
            "district3UseTax": 0,
            "district4Code": "30",
            "district4SalesTax": 0.01,
            "district4UseTax": 0.01,
            "district5Code": "",
            "district5SalesTax": 0,
            "district5UseTax": 0,
            "originDestination": "D"
          }
        ],
        "addressDetail": {
          "normalizedAddress": "feature available for geo address lookups only",
          "incorporated": "feature available for geo address lookups only",
          "geoLat": 0,
          "geoLng": 0
        }
      }

  calculate_cart:
    description: "Actual ZipTax response for CalculateCart"
    endpoint: "POST /calculate/cart"
    request_example: |
      {
        "items": [
          {
            "currency": { "currencyCode": "USD" },
            "customerId": "customer-453",
            "destination": {
              "address": "200 Spectrum Center Dr, Irvine, CA 92618-1905"
            },
            "origin": {
              "address": "323 Washington Ave N, Minneapolis, MN 55401-2427"
            },
            "lineItems": [
              {
                "itemId": "item-1",
                "price": 10.75,
                "quantity": 1.5,
                "taxabilityCode": 0
              }
            ]
          }
        ]
      }
    response_example: |
      {
        "items": [
          {
            "cartId": "ce4a...ccefdd",
            "customerId": "customer-453",
            "destination": {
              "address": "200 Spectrum Center Dr, Irvine, CA 92618-1905"
            },
            "origin": {
              "address": "323 Washington Ave N, Minneapolis, MN 55401-2427"
            },
            "lineItems": [
              {
                "itemId": "item-1",
                "price": 10.75,
                "quantity": 1.5,
                "tax": {
                  "rate": 0.09025,
                  "amount": 1.46
                }
              }
            ]
          }
        ]
      }

  taxcloud_calculate_cart:
    description: "Actual TaxCloud response for CalculateCart (when routed to TaxCloud)"
    endpoint: "POST /tax/connections/{connectionId}/carts"
    request_example: |
      {
        "items": [
          {
            "currency": { "currencyCode": "USD" },
            "customerId": "customer-453",
            "destination": {
              "city": "Irvine",
              "line1": "200 Spectrum Center Dr",
              "state": "CA",
              "zip": "92618-1905"
            },
            "origin": {
              "city": "Minneapolis",
              "line1": "323 Washington Ave N",
              "state": "MN",
              "zip": "55401-2427"
            },
            "lineItems": [
              {
                "index": 0,
                "itemId": "item-1",
                "price": 10.75,
                "quantity": 1.5,
                "tic": 0
              }
            ]
          }
        ]
      }
    response_example: |
      {
        "connectionId": "25eb9b97-5acb-492d-b720-c03e79cf715a",
        "items": [
          {
            "cartId": "ce4a1234-5678-90ab-cdef-1234567890ab",
            "customerId": "customer-453",
            "currency": {
              "currencyCode": "USD"
            },
            "deliveredBySeller": false,
            "destination": {
              "line1": "200 Spectrum Center Dr",
              "city": "Irvine",
              "state": "CA",
              "zip": "92618-1905",
              "countryCode": "US"
            },
            "origin": {
              "line1": "323 Washington Ave N",
              "city": "Minneapolis",
              "state": "MN",
              "zip": "55401-2427",
              "countryCode": "US"
            },
            "exemption": {
              "exemptionId": null,
              "isExempt": null
            },
            "lineItems": [
              {
                "index": 0,
                "itemId": "item-1",
                "price": 10.75,
                "quantity": 1.5,
                "tax": {
                  "amount": 1.46,
                  "rate": 0.0903
                },
                "tic": 0
              }
            ]
          }
        ],
        "transactionDate": "2024-01-15T09:30:00Z"
      }
    notes:
      - "The request body shown above is the TRANSFORMED version (after SDK parsing)"
      - "The SDK receives CalculateCartRequest with single-string addresses and transforms them"
      - "TaxCloud returns structured addresses, connectionId, transactionDate, and per-item tic"
      - "The response is wrapped in TaxCloudCalculateCartResponse, not CalculateCartResponse"

  taxcloud_create_order:
    description: "Actual TaxCloud response for CreateOrder"
    endpoint: "POST /tax/connections/{connectionId}/orders"
    example: |
      {
        "orderId": "my-order-1",
        "customerId": "customer-453",
        "connectionId": "25eb9b97-5acb-492d-b720-c03e79cf715a",
        "transactionDate": "2024-01-15T09:30:00Z",
        "completedDate": "2024-01-15T09:30:00Z",
        "origin": {
          "line1": "323 Washington Ave N",
          "city": "Minneapolis",
          "state": "MN",
          "zip": "55401-2427",
          "countryCode": "US"
        },
        "destination": {
          "line1": "323 Washington Ave N",
          "city": "Minneapolis",
          "state": "MN",
          "zip": "55401-2427",
          "countryCode": "US"
        },
        "lineItems": [
          {
            "index": 0,
            "itemId": "item-1",
            "price": 10.8,
            "quantity": 1.5,
            "tax": {
              "amount": 1.31,
              "rate": 0.0813
            },
            "tic": 0
          }
        ],
        "currency": {
          "currencyCode": "USD"
        },
        "channel": null,
        "deliveredBySeller": false,
        "excludeFromFiling": false,
        "exemption": {
          "exemptionId": null,
          "isExempt": null
        }
      }

  taxcloud_get_order:
    description: "Actual TaxCloud response for GetOrder by ID"
    endpoint: "GET /tax/connections/{connectionId}/orders/{orderId}"
    example: |
      {
        "orderId": "my-order-1",
        "customerId": "customer-453",
        "connectionId": "25eb9b97-5acb-492d-b720-c03e79cf715a",
        "transactionDate": "2024-01-15T09:30:00Z",
        "completedDate": "2024-01-15T09:30:00Z",
        "origin": {
          "line1": "323 Washington Ave N",
          "city": "Minneapolis",
          "state": "MN",
          "zip": "55401-2427",
          "countryCode": "US"
        },
        "destination": {
          "line1": "323 Washington Ave N",
          "city": "Minneapolis",
          "state": "MN",
          "zip": "55401-2427",
          "countryCode": "US"
        },
        "lineItems": [
          {
            "index": 0,
            "itemId": "item-1",
            "price": 10.8,
            "quantity": 1.5,
            "tax": {
              "amount": 1.31,
              "rate": 0.0813
            },
            "tic": 0
          }
        ],
        "currency": {
          "currencyCode": "USD"
        },
        "channel": null,
        "deliveredBySeller": false,
        "excludeFromFiling": false,
        "exemption": {
          "exemptionId": null,
          "isExempt": null
        }
      }

  taxcloud_update_order:
    description: "Actual TaxCloud response for UpdateOrder (updating completedDate)"
    endpoint: "PATCH /tax/connections/{connectionId}/orders/{orderId}"
    request_example: |
      {
        "completedDate": "2024-01-16T10:00:00Z"
      }
    response_example: |
      {
        "orderId": "my-order-1",
        "customerId": "customer-453",
        "connectionId": "25eb9b97-5acb-492d-b720-c03e79cf715a",
        "transactionDate": "2024-01-15T09:30:00Z",
        "completedDate": "2024-01-16T10:00:00Z",
        "origin": {
          "line1": "323 Washington Ave N",
          "city": "Minneapolis",
          "state": "MN",
          "zip": "55401-2427",
          "countryCode": "US"
        },
        "destination": {
          "line1": "323 Washington Ave N",
          "city": "Minneapolis",
          "state": "MN",
          "zip": "55401-2427",
          "countryCode": "US"
        },
        "lineItems": [
          {
            "index": 0,
            "itemId": "item-1",
            "price": 10.8,
            "quantity": 1.5,
            "tax": {
              "amount": 1.31,
              "rate": 0.0813
            },
            "tic": 0
          }
        ],
        "currency": {
          "currencyCode": "USD"
        },
        "channel": null,
        "deliveredBySeller": false,
        "excludeFromFiling": false,
        "exemption": {
          "exemptionId": null,
          "isExempt": null
        }
      }

  taxcloud_refund_order:
    description: "Actual TaxCloud response for RefundOrder (array of refund transactions)"
    endpoint: "POST /tax/connections/{connectionId}/orders/refunds/{orderId}"
    request_example: |
      {
        "items": [
          {
            "itemId": "item-1",
            "quantity": 1.0
          }
        ]
      }
    response_example: |
      [
        {
          "connectionId": "25eb9b97-5acb-492d-b720-c03e79cf715a",
          "createdDate": "2024-01-17T14:30:00Z",
          "items": [
            {
              "index": 0,
              "itemId": "item-1",
              "price": 10.8,
              "quantity": 1.0,
              "tax": {
                "amount": 0.87
              },
              "tic": 0
            }
          ],
          "returnedDate": "2024-01-17T14:30:00Z"
        }
      ]

# -----------------------------------------------------------------------------
# CI/CD Quality Requirements
# -----------------------------------------------------------------------------
# These are MANDATORY - all checks must pass for the SDK to be release-ready
quality_requirements:
  code_coverage:
    minimum: 80
    tool: "pytest-cov"
    command: "pytest --cov=src/ziptax --cov-report=term && coverage report --fail-under=80"
    critical_modules:
      - "src/ziptax/utils/http.py"
      - "src/ziptax/utils/retry.py"
      - "src/ziptax/exceptions.py"

  type_checking:
    tool: "mypy"
    version: ">=1.0.0"
    python_version: "3.9"  # Important: 3.8 not supported by mypy
    strict: false
    command: "mypy src/ziptax/"
    config:
      warn_return_any: false
      warn_unused_configs: true
      disallow_untyped_defs: false
    notes:
      - "Use 'cast' for Dict[str, Any] returns from response.json()"
      - "Async decorators must return Callable[..., Awaitable[T]] not Callable[..., T]"

  code_formatting:
    tool: "black"
    version: ">=23.0.0"
    line_length: 88
    command: "black --check src/ tests/"

  linting:
    tool: "ruff"
    version: ">=0.1.0"
    command: "ruff check src/ tests/"
    config_section: "[tool.ruff.lint]"  # Modern ruff uses this, not [tool.ruff]
    per_file_ignores:
      - file: "src/ziptax/models/responses.py"
        ignore: ["N815"]  # Allow camelCase for API field names
      - file: "src/ziptax/resources/functions.py"
        ignore: ["N802"]  # Allow PascalCase for API endpoint function names

  pydantic_requirements:
    version: ">=2.0.0"
    use_config_dict: true  # MUST use ConfigDict, not deprecated Config class
    field_aliases: true  # Required for camelCase to snake_case mapping
    example: |
      from pydantic import BaseModel, ConfigDict, Field

      class MyModel(BaseModel):
          model_config = ConfigDict(populate_by_name=True)

          my_field: str = Field(..., alias="myField")  # API uses camelCase

# -----------------------------------------------------------------------------
# Version History
# -----------------------------------------------------------------------------
version_history:
  - version: "1.0.0"
    date: "2024-01-15"
    changes:
      - "Initial release"
      - "Support for TaxRates and Jurisdictions resources"
      - "Basic authentication and error handling"
