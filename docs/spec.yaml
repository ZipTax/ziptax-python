# =============================================================================
# SDK Generation Template for ZipTax API
# =============================================================================
# This template provides a comprehensive spec for codegen agents

# -----------------------------------------------------------------------------
# Project Metadata
# -----------------------------------------------------------------------------
project:
  name: "ziptax-python"
  language: "python"
  version: "1.0.0"
  description: "Official Python SDK for the ZipTax API"

  # Repository information
  repository:
    url: "https://github.com/ziptax/ziptax-python"
    type: "git"

  # License
  license: "MIT"

  # Maintainer information
  maintainers:
    - name: "ZipTax Team"
      email: "support@zip.tax"

# -----------------------------------------------------------------------------
# API Configuration
# -----------------------------------------------------------------------------
api:
  # Base API details
  name: "ZipTax API"
  version: "v60"
  base_url: "https://api.zip-tax.com/"

  # API specification source
  spec:
    type: "openapi"
    version: "3.0.0"
    source: "https://api.zip-tax.com/openapi.json"

  # Authentication methods
  authentication:
    type: "api_key"
    location: "header"
    parameter_name: "X-API-Key"

    # Additional auth configurations
    supports_multiple_methods: false
    methods: []

# -----------------------------------------------------------------------------
# SDK Configuration
# -----------------------------------------------------------------------------
sdk:
  # Package/module naming
  package_name: "ziptax"
  namespace: "Ziptax"

  # SDK structure approach
  structure:
    type: "client-based"
    client_class: "ZiptaxClient"

  # Features to include
  features:
    async_support: true       # Include async/await methods
    retry_logic: true         # Automatic retry on failures
    request_logging: true     # Built-in request/response logging
    response_caching: false   # Cache responses
    pagination_helpers: true  # Helper methods for paginated endpoints
    batch_operations: false   # Batch request support
    webhooks: false           # Webhook handling utilities

  # Error handling
  error_handling:
    use_custom_exceptions: true
    exception_hierarchy: true  # Create exception hierarchy
    include_retry_exceptions: true

  # Type safety
  type_safety:
    use_type_hints: true      # Language-specific
    validate_inputs: true     # Runtime input validation
    strict_mode: false        # Strict type checking

# -----------------------------------------------------------------------------
# API Endpoints & Resources
# -----------------------------------------------------------------------------
# Define the API structure and endpoints to implement
resources:
      - name: "GetSalesTaxByAddress"
        http_method: "GET"
        path: "/request/v60/"
        description: "Returns sales and use tax rate details from an address input."
        operation_id: "getTaxRatesV60"
        parameters:
          - name: "address"
            type: "string"
            required: true
            location: "query"
            description: "Full or partial street address for geocoding"
            validation:
              max_length: 100
          - name: "taxabilityCode"
            type: "string"
            format: "date"
            required: false
            location: "query"
            description: "Historical date for rates (YYYY-MM format)"
            validation:
              pattern: "^[0-9]{4}-[0-9]{2}$"
          - name: "countryCode"
            type: "string"
            required: false
            location: "query"
            description: "Country code"
            default: "USA"
            enum: ["USA", "CAN"]
          - name: "historical"
            type: "string"
            format: "date"
            required: false
            location: "query"
            description: "Historical date for rates (YYYY-MM format)"
            validation:
              pattern: "^[0-9]{4}-[0-9]{2}$"
          - name: "format"
            type: "string"
            required: false
            location: "query"
            description: "Response format"
            default: "json"
            enum: ["json", "xml"]
        returns:
          type: "V60Response"
          is_array: false
      - name: "GetSalesTaxByGeoLocation"
        http_method: "GET"
        path: "/request/v60/"
        description: "Returns sales and use tax rate details from a geolocation input."
        operation_id: "getTaxRatesV60"
        parameters:
          - name: "lat"
            type: "string"
            required: true
            location: "query"
            description: "Latitude for geolocation"
            validation:
              max_length: 100
          - name: "lng"
            type: "string"
            required: true
            location: "query"
            description: "Longitude for geolocation"
            validation:
              max_length: 100
          - name: "countryCode"
            type: "string"
            required: false
            location: "query"
            description: "Country code"
            default: "USA"
            enum: ["USA", "CAN"]
          - name: "historical"
            type: "string"
            format: "date"
            required: false
            location: "query"
            description: "Historical date for rates (YYYY-MM format)"
            validation:
              pattern: "^[0-9]{4}-[0-9]{2}$"
          - name: "format"
            type: "string"
            required: false
            location: "query"
            description: "Response format"
            default: "json"
            enum: ["json", "xml"]
        returns:
          type: "V60Response"
          is_array: false
      - name: "GetAccountMetrics"
        http_method: "GET"
        path: "/account/v60/metrics"
        description: "Returns account metrics related to sales and use tax."
        operation_id: "getAccountMetricsV60"
        parameters:
          - name: "key"
            type: "string"
            required: false
            location: "query"
            description: "Response format"
            default: "json"
            enum: ["json", "xml"]
        returns:
          type: "V60AccountMetrics"
          is_array: false
          
# -----------------------------------------------------------------------------
# Data Models
# -----------------------------------------------------------------------------
# Define the data structures/models used in the API
#
# IMPORTANT IMPLEMENTATION NOTES:
# 1. Use Pydantic v2 with ConfigDict (not deprecated Config class)
# 2. API returns camelCase fields - use Field aliases for snake_case SDK fields
# 3. Many fields are OPTIONAL in real responses despite appearing required
# 4. Jurisdiction names (jurName) contain actual values like "CA", "ORANGE" - NOT enums
# 5. See "actual_api_responses" section below for real response structures
models:
  # ---------------------------------------------------------------------------
  # API Version 6.0 Models (Latest)
  # ---------------------------------------------------------------------------
  - name: "V60Response"
    description: "Response for v6.0 API - structured format with separate components"
    properties:
      - name: "metadata"
        type: "V60Metadata"
        required: true
        description: "Response metadata"
      - name: "base_rates"
        type: "array"
        items_type: "V60BaseRate"
        required: false  # Can be null/missing
        api_field: "baseRates"  # API uses camelCase
        description: "Base tax rates by jurisdiction"
      - name: "service"
        type: "V60Service"
        required: true
        description: "Service taxability information"
      - name: "shipping"
        type: "V60Shipping"
        required: true
        description: "Shipping taxability information"
      - name: "sourcing_rules"
        type: "V60SourcingRules"
        required: false  # Can be null/missing
        api_field: "sourcingRules"  # IMPORTANT: API field is 'sourcingRules' not 'originDestination'
        description: "Sourcing rules (origin vs destination)"
      - name: "tax_summaries"
        type: "array"
        items_type: "V60TaxSummary"
        required: false  # Can be null/missing
        api_field: "taxSummaries"  # API uses camelCase
        description: "Tax rate summaries"
      - name: "addressDetail"
        type: "V60AddressDetail"
        required: true
        api_field: "addressDetail"  # API keeps this as camelCase (no snake_case conversion)
        description: "Address details"

  - name: "V60Metadata"
    description: "Metadata for v6.0 response"
    properties:
      - name: "version"
        type: "string"
        required: true
        description: "API version"
        example: "v60"
      - name: "response"
        type: "V60ResponseInfo"
        required: true
        description: "Response information (NESTED OBJECT - not flat)"

  - name: "V60ResponseInfo"
    description: "Response information nested in metadata"
    properties:
      - name: "code"
        type: "integer"
        format: "int64"
        required: true
        description: "Response code (100=success)"
        example: 100
      - name: "name"
        type: "string"
        required: true
        description: "Response code name"
        example: "RESPONSE_CODE_SUCCESS"
      - name: "message"
        type: "string"
        required: true
        description: "Response message"
        example: "Successful API Request."
      - name: "definition"
        type: "string"
        required: true
        description: "Schema definition URL"
        example: "http://api.zip-tax.com/request/v60/schema"

  - name: "V60BaseRate"
    description: "Base tax rate for a specific jurisdiction"
    properties:
      - name: "rate"
        type: "number"
        format: "float"
        required: true
        description: "Tax rate (decimal format, e.g., 0.0775 for 7.75%)"
      - name: "rate_id"
        type: "string"
        required: false  # OPTIONAL in real API responses
        api_field: "rateId"  # API uses camelCase
        description: "Rate identifier from tax table"
      - name: "jur_type"
        type: "string"  # STRING not enum - API may return various types
        required: true
        api_field: "jurType"  # API uses camelCase
        description: "Jurisdiction type (e.g., US_STATE_SALES_TAX, US_COUNTY_SALES_TAX)"
        example: "US_STATE_SALES_TAX"
      - name: "jur_name"
        type: "string"  # STRING not enum - contains actual names like "CA", "ORANGE"
        required: true
        api_field: "jurName"  # API uses camelCase
        description: "Actual jurisdiction name (e.g., 'CA', 'ORANGE', 'IRVINE')"
        example: "CA"
      - name: "jur_description"
        type: "string"
        required: false  # OPTIONAL in real API responses
        api_field: "jurDescription"  # API uses camelCase
        description: "Human-readable jurisdiction description"
        example: "US State Sales Tax"
      - name: "jur_tax_code"
        type: "string"
        required: false  # OPTIONAL in real API responses
        api_field: "jurTaxCode"  # API uses camelCase
        description: "Tax code for jurisdiction"
        example: "06"

  - name: "V60Service"
    description: "Service taxability information"
    properties:
      - name: "adjustment_type"
        type: "string"
        required: true
        api_field: "adjustmentType"  # API uses camelCase
        description: "Service adjustment type"
        example: "SERVICE_TAXABLE"
      - name: "taxable"
        type: "string"
        required: true
        description: "Taxability indicator"
        enum: ["Y", "N"]
      - name: "description"
        type: "string"
        required: true
        description: "Service description"

  - name: "V60Shipping"
    description: "Shipping taxability information"
    properties:
      - name: "adjustment_type"
        type: "string"
        required: true
        api_field: "adjustmentType"  # API uses camelCase
        description: "Shipping adjustment type"
        example: "FREIGHT_TAXABLE"
      - name: "taxable"
        type: "string"
        required: true
        description: "Taxability indicator"
        enum: ["Y", "N"]
      - name: "description"
        type: "string"
        required: true
        description: "Shipping description"

  - name: "V60SourcingRules"
    description: "Sourcing rules (origin vs destination) - API field is 'sourcingRules'"
    api_field: "sourcingRules"  # IMPORTANT: Not 'originDestination'
    properties:
      - name: "adjustment_type"
        type: "string"
        required: true
        api_field: "adjustmentType"  # API uses camelCase
        description: "Sourcing rules type"
        example: "ORIGIN_DESTINATION"
      - name: "description"
        type: "string"
        required: true
        description: "Sourcing rules description"
        example: "Destination Based Taxation"
      - name: "value"
        type: "string"
        required: true
        description: "Origin/destination indicator"
        enum: ["O", "D"]

  - name: "V60TaxSummary"
    description: "Tax rate summary"
    properties:
      - name: "rate"
        type: "number"
        format: "float"
        required: true
        description: "Summary tax rate"
      - name: "tax_type"
        type: "string"  # STRING not strict enum
        required: true
        api_field: "taxType"  # API uses camelCase
        description: "Tax type (e.g., SALES_TAX, USE_TAX)"
        example: "SALES_TAX"
      - name: "summary_name"
        type: "string"
        required: true
        api_field: "summaryName"  # API uses camelCase
        description: "Summary description"
        example: "Total Base Sales Tax"
      - name: "display_rates"
        type: "array"
        items_type: "V60DisplayRate"
        required: true
        api_field: "displayRates"  # API uses camelCase
        description: "Array of display rate breakdowns"

  - name: "V60DisplayRate"
    description: "Display rate breakdown within tax summary"
    properties:
      - name: "name"
        type: "string"
        required: true
        description: "Display rate name"
        example: "Total Rate"
      - name: "rate"
        type: "number"
        format: "float"
        required: true
        description: "Display rate value"
        example: 0.0775

  - name: "V60AddressDetail"
    description: "Address detail information for v6.0"
    properties:
      - name: "normalizedAddress"
        type: "string"
        required: true
        description: "Normalized address"
      - name: "incorporated"
        type: "string"
        required: true
        description: "Incorporation status"
        enum: ["true", "false"]
      - name: "geoLat"
        type: "number"
        format: "float"
        required: true
        description: "Geocoded latitude"
      - name: "geoLng"
        type: "number"
        format: "float"
        required: true
        description: "Geocoded longitude"
  - name: "V60AccountMetrics"
    description: "Account metrics by API key"
    properties:
      - name: "core_request_count"
        type: "integer"
        format: "int64"
        required: true
        description: "Number of core API requests made"
      - name: "core_request_limit"
        type: "integer"
        format: "int64"
        required: true
        description: "Maximum allowed core API requests"
      - name: "core_usage_percent"
        type: "number"
        format: "float"
        required: true
        description: "Percentage of core request limit used"
      - name: "geo_enabled"
        type: "boolean"
        required: true
        description: "Whether geolocation features are enabled"
      - name: "geo_request_count"
        type: "integer"
        format: "int64"
        required: true
        description: "Number of geolocation requests made"
      - name: "geo_request_limit"
        type: "integer"
        format: "int64"
        required: true
        description: "Maximum allowed geolocation requests"
      - name: "geo_usage_percent"
        type: "number"
        format: "float"
        required: true
        description: "Percentage of geolocation request limit used"
      - name: "is_active"
        type: "boolean"
        required: true
        description: "Whether the account is currently active"
      - name: "message"
        type: "string"
        required: true
        description: "Account status or informational message"


# -----------------------------------------------------------------------------
# Dependencies
# -----------------------------------------------------------------------------
dependencies:
  # Runtime dependencies
  runtime:
    - name: "requests"        # HTTP client library (language-specific)
      version: ">=2.28.0"
      purpose: "HTTP requests"
    - name: "pydantic"        # Data validation (language-specific)
      version: ">=2.0.0"
      purpose: "Data validation and models"

  # Development dependencies
  development:
    - name: "pytest"
      version: ">=7.0.0"
      purpose: "Testing framework"
    - name: "pytest-cov"
      version: ">=4.0.0"
      purpose: "Code coverage"
    - name: "black"
      version: ">=23.0.0"
      purpose: "Code formatting"
    - name: "mypy"
      version: ">=1.0.0"
      purpose: "Type checking"
    - name: "ruff"
      version: ">=0.1.0"
      purpose: "Linting"

# -----------------------------------------------------------------------------
# Project Structure
# -----------------------------------------------------------------------------
# Define the directory structure for the SDK
structure:
  root_files:
    - "README.md"
    - "LICENSE"
    - "setup.py"
    - ".gitignore"
    - "pyproject.toml"

  directories:
    - path: "src/ziptax"
      contents:
        - "__init__.py"
        - "client.py"
        - "config.py"
        - "exceptions.py"

    - path: "src/ziptax/resources"
      contents:
        - "__init__.py"
        - "functions.py"

    - path: "src/ziptax/models"
      contents:
        - "__init__.py"
        - "responses.py"

    - path: "src/ziptax/utils"
      contents:
        - "__init__.py"
        - "http.py"
        - "retry.py"
        - "validation.py"

    - path: "tests"
      contents:
        - "__init__.py"
        - "test_client.py"
        - "test_functions.py"
        - "test_http.py"      # REQUIRED: Tests for HTTPClient utility
        - "test_retry.py"     # REQUIRED: Tests for retry logic
        - "conftest.py"

    - path: "examples"
      contents:
        - "basic_usage.py"
        - "async_usage.py"
        - "error_handling.py"

    - path: "docs"
      contents:
        - "index.md"
        - "quickstart.md"
        - "api-reference.md"

# -----------------------------------------------------------------------------
# Code Generation Settings
# -----------------------------------------------------------------------------
code_generation:
  # Style guide compliance
  style:
    follow_language_conventions: true
    style_guide: "PEP 8"
    line_length: 88
    indent_size: 4
    indent_style: "spaces"

  # Documentation
  documentation:
    style: "google"
    include_examples: true
    include_type_info: true
    minimum_coverage: "public_api"

  # Testing
  testing:
    framework: "pytest"
    include_unit_tests: true
    include_integration_tests: true
    mock_api_responses: true
    target_coverage: 80

  # Code quality
  quality:
    include_linter_config: true
    include_formatter_config: true
    include_type_checker_config: true
    include_pre_commit_hooks: true

# -----------------------------------------------------------------------------
# Build & Distribution
# -----------------------------------------------------------------------------
build:
  # Build system
  system: "setuptools"

  # Build configuration
  output_directory: "dist"

  # Distribution
  distribution:
    platforms:
      - "pypi"

    # Package metadata
    classifiers:
      - "Development Status :: 4 - Beta"
      - "Intended Audience :: Developers"
      - "License :: OSI Approved :: MIT License"
      - "Programming Language :: Python :: 3"
      - "Programming Language :: Python :: 3.8"
      - "Programming Language :: Python :: 3.9"
      - "Programming Language :: Python :: 3.10"
      - "Programming Language :: Python :: 3.11"

    keywords:
      - "tax"
      - "ziptax"
      - "api"
      - "sdk"
      - "sales tax"

# -----------------------------------------------------------------------------
# Documentation
# -----------------------------------------------------------------------------
documentation:
  # Documentation tools
  generator: "sphinx"
  theme: "readthedocs"

  # Content requirements
  sections:
    - name: "Installation"
      required: true
    - name: "Quick Start"
      required: true
    - name: "Authentication"
      required: true
    - name: "API Reference"
      required: true
      auto_generate: true
    - name: "Error Handling"
      required: true
    - name: "Examples"
      required: true
    - name: "Contributing"
      required: false
    - name: "Changelog"
      required: true

  # API documentation
  api_docs:
    include_request_examples: true
    include_response_examples: true
    include_error_examples: true
    format: "markdown"

# -----------------------------------------------------------------------------
# Examples
# -----------------------------------------------------------------------------
examples:
  - name: "Basic Usage"
    file: "examples/basic_usage.py"
    description: "Simple example showing basic SDK initialization and usage"
    required: true

  - name: "Async Operations"
    file: "examples/async_usage.py"
    description: "Example using async/await for concurrent operations"
    required: false

  - name: "Error Handling"
    file: "examples/error_handling.py"
    description: "Demonstrates proper error handling patterns"
    required: true

  - name: "Pagination"
    file: "examples/pagination.py"
    description: "Working with paginated endpoints"
    required: false

# -----------------------------------------------------------------------------
# CI/CD Configuration
# -----------------------------------------------------------------------------
ci_cd:
  # Continuous Integration
  platform: "github_actions"

  workflows:
    - name: "Test"
      triggers: ["push", "pull_request"]
      jobs:
        - "lint"
        - "type-check"
        - "test"
        - "coverage"

    - name: "Publish"
      triggers: ["release"]
      jobs:
        - "build"
        - "publish"

  # Testing matrix
  test_matrix:
    python_versions: ["3.8", "3.9", "3.10", "3.11"]
    os: ["ubuntu-latest", "macos-latest", "windows-latest"]

# -----------------------------------------------------------------------------
# Additional Instructions
# -----------------------------------------------------------------------------
# Any special instructions or considerations for this SDK
instructions:
  special_considerations:
    - "Ensure all monetary values use appropriate decimal/currency types"
    - "ZIP codes should be validated for format"
    - "Date handling should respect timezone requirements"
    - "All API responses should be properly typed"

  # Code patterns to follow
  patterns:
    - pattern: "Config-based client initialization"
      example: |
        client = ZipTaxClient.api_key('xxx')
        client.config['format'] = 'json'
        client.request.GetSalesTaxByAddress("200 Spectrum Center Drive, Irvine, CA 92618")

    - pattern: "Resource-based method organization"
      example: "client.request.GetSalesTaxByAddress(address)"

    - pattern: "Consistent error handling"
      example: "try/except blocks with specific exception types"

  # Avoid these patterns
  anti_patterns:
    - "Don't use global state for configuration"
    - "Avoid bare except clauses"
    - "Don't ignore type hints in favor of dynamic typing"

# -----------------------------------------------------------------------------
# Actual API Response Examples
# -----------------------------------------------------------------------------
# CRITICAL: These are REAL API responses - use these to validate model structure
actual_api_responses:
  v60_tax_lookup:
    description: "Actual V60 response for GetSalesTaxByAddress"
    endpoint: "GET /request/v60/"
    example: |
      {
        "metadata": {
          "version": "v60",
          "response": {
            "code": 100,
            "name": "RESPONSE_CODE_SUCCESS",
            "message": "Successful API Request.",
            "definition": "http://api.zip-tax.com/request/v60/schema"
          }
        },
        "baseRates": [
          {
            "rate": 0.06,
            "jurType": "US_STATE_SALES_TAX",
            "jurName": "CA",
            "jurDescription": "US State Sales Tax",
            "jurTaxCode": "06"
          },
          {
            "rate": 0.0025,
            "jurType": "US_COUNTY_SALES_TAX",
            "jurName": "ORANGE",
            "jurDescription": "US County Sales Tax"
          },
          {
            "rate": 0.015,
            "jurType": "US_CITY_SALES_TAX",
            "jurName": "IRVINE"
          }
        ],
        "service": {
          "adjustmentType": "SERVICE_TAXABLE",
          "taxable": "N",
          "description": "Services non-taxable"
        },
        "shipping": {
          "adjustmentType": "FREIGHT_TAXABLE",
          "taxable": "N",
          "description": "Freight non-taxable"
        },
        "sourcingRules": {
          "adjustmentType": "ORIGIN_DESTINATION",
          "description": "Destination Based Taxation",
          "value": "D"
        },
        "taxSummaries": [
          {
            "rate": 0.0775,
            "taxType": "SALES_TAX",
            "summaryName": "Total Base Sales Tax",
            "displayRates": [
              {
                "name": "Total Rate",
                "rate": 0.0775
              }
            ]
          }
        ],
        "addressDetail": {
          "normalizedAddress": "200 Spectrum Center Dr, Irvine, CA 92618-5003, United States",
          "incorporated": "true",
          "geoLat": 33.65253,
          "geoLng": -117.74794
        }
      }

  v60_account_metrics:
    description: "Actual V60AccountMetrics response"
    endpoint: "GET /account/v60/metrics"
    example: |
      {
        "core_request_count": 15595,
        "core_request_limit": 1000000,
        "core_usage_percent": 1.5595,
        "geo_enabled": true,
        "geo_request_count": 43891,
        "geo_request_limit": 1000000,
        "geo_usage_percent": 4.3891,
        "is_active": true,
        "message": "Contact support@zip.tax to modify your account"
      }

# -----------------------------------------------------------------------------
# CI/CD Quality Requirements
# -----------------------------------------------------------------------------
# These are MANDATORY - all checks must pass for the SDK to be release-ready
quality_requirements:
  code_coverage:
    minimum: 80
    tool: "pytest-cov"
    command: "pytest --cov=src/ziptax --cov-report=term && coverage report --fail-under=80"
    critical_modules:
      - "src/ziptax/utils/http.py"
      - "src/ziptax/utils/retry.py"
      - "src/ziptax/exceptions.py"

  type_checking:
    tool: "mypy"
    version: ">=1.0.0"
    python_version: "3.9"  # Important: 3.8 not supported by mypy
    strict: false
    command: "mypy src/ziptax/"
    config:
      warn_return_any: false
      warn_unused_configs: true
      disallow_untyped_defs: false
    notes:
      - "Use 'cast' for Dict[str, Any] returns from response.json()"
      - "Async decorators must return Callable[..., Awaitable[T]] not Callable[..., T]"

  code_formatting:
    tool: "black"
    version: ">=23.0.0"
    line_length: 88
    command: "black --check src/ tests/"

  linting:
    tool: "ruff"
    version: ">=0.1.0"
    command: "ruff check src/ tests/"
    config_section: "[tool.ruff.lint]"  # Modern ruff uses this, not [tool.ruff]
    per_file_ignores:
      - file: "src/ziptax/models/responses.py"
        ignore: ["N815"]  # Allow camelCase for API field names
      - file: "src/ziptax/resources/functions.py"
        ignore: ["N802"]  # Allow PascalCase for API endpoint function names

  pydantic_requirements:
    version: ">=2.0.0"
    use_config_dict: true  # MUST use ConfigDict, not deprecated Config class
    field_aliases: true  # Required for camelCase to snake_case mapping
    example: |
      from pydantic import BaseModel, ConfigDict, Field

      class MyModel(BaseModel):
          model_config = ConfigDict(populate_by_name=True)

          my_field: str = Field(..., alias="myField")  # API uses camelCase

# -----------------------------------------------------------------------------
# Version History
# -----------------------------------------------------------------------------
version_history:
  - version: "1.0.0"
    date: "2024-01-15"
    changes:
      - "Initial release"
      - "Support for TaxRates and Jurisdictions resources"
      - "Basic authentication and error handling"
